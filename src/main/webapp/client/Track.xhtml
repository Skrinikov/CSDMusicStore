<ui:composition
    template="/WEB-INF/templates/master.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="extra-meta">

        <f:metadata>
            <f:viewParam name="id" value="#{trackCLBack.trackId}" /> 
            <f:event type="preRenderView" listener="#{trackCLBack.init}" />
        </f:metadata>

    </ui:define>

    <ui:define name="windowTitle">#{trackCLBack.title}</ui:define>

    <ui:define name="content">
        <div class="container top-buffer" >

            <div class="row album-header album-row"> 
                <div class="col-md-3 col-xs-12">
                    <p:graphicImage name="images/covers/#{trackCLBack.track.coverFile}"  style="max-width: 100%; max-height: 350px" styleClass="albumHeader"/>
                </div>
                <div class="col-md-9 col-xs-12" style="position:relative;">
                    <h3>Track</h3>
                    <h1>#{trackCLBack.track.title}</h1>
                    <h3>Artist(s): #{trackCLBack.artists}</h3>
                    <h3>Genre: #{trackCLBack.track.genre}</h3>
                    <h3>Duration: #{trackCLBack.duration}</h3>
                    <h3>Writer(s): #{trackCLBack.writer}</h3>
                    <div class="album-actions">
                        <h:form>
                            <h:commandButton value="$#{trackCLBack.getPrice(trackCLBack.track)}" action="#{trackCLBack.addToCart}" class="btn btn-success" />
                        </h:form>
                    </div>
                </div>
            </div>
            <div class="row album-additional-information">
                <p>Album: 
                    <h:link outcome="Album">
                        <span>#{trackCLBack.album}</span>
                        <f:param name="id" value="#{trackCLBack.album.id}" />
                    </h:link> 
                </p>
            </div>

            <div class="row top-buffer">
                <h3 class="similar-albums-header">Related Tracks</h3>
            </div>

            <div class="row text-center" style="margin-bottom: 20px;">
                <ui:repeat var="relatedTrack" value="#{trackCLBack.similarTracks}" >
                    <div class="col-md-4 col-xs-12 similar-albums small-margin-bottom">
                        <div class="similar-albums-inner">
                            <h:link outcome="Track">
                                <p:graphicImage name="images/covers/#{relatedTrack.coverFile}"  style="max-height: 275px"/>
                                <h3>#{relatedTrack.title}</h3>
                                <h5>#{relatedTrack.album.artist.name}</h5>
                                <h6>#{relatedTrack.album.title}</h6>
                                <f:param name="id" value="#{relatedTrack.id}" />
                            </h:link>
                        </div>
                    </div>
                </ui:repeat>
            </div>

            <div class="row top-buffer">
                <h3 class="similar-albums-header">Related Albums</h3>
            </div>

            <div class="row text-center" style="margin-bottom: 20px;">
                <ui:repeat var="relatedAlbum" value="#{trackCLBack.relatedAlbums}">
                    <div class="col-md-4 col-xs-12 similar-albums small-margin-bottom">
                        <div class="similar-albums-inner">
                            <h:link outcome="Album">
                                <p:graphicImage name="images/covers/#{relatedAlbum.tracks.get(0).coverFile}"  style="max-height: 275px"/>
                                <h3>#{relatedAlbum.title}</h3>
                                <h5>#{relatedAlbum.artist}</h5>
                                <f:param name="id" value="#{relatedAlbum.id}" />
                            </h:link>
                        </div>
                    </div>
                </ui:repeat>
            </div>

            <div class="row top-buffer">
                <h3 class="similar-albums-header">Reviews</h3>
            </div>

            <div class="row text-center">
                <h:form rendered="#{trackCLBack.loggedIn}">
                    
                    <p:outputLabel>
                        
                        <p:message for="comment" />
                        <h3>Add a Review</h3>
                        <p:inputTextarea id="comment" rows="10" cols="75" value="#{trackCLBack.review.text}" label="comment" >
                            <f:validateRequired />
                           
                        </p:inputTextarea>
                        
                        <br />


                        <p:rating id="rating" value="#{trackCLBack.review.rating}" disabled="false" >
                            <f:validateLongRange minimum="1" maximum="5" />
                            
                        </p:rating>
                            
                        <br />

                        <h:commandButton value="Submit" action="#{trackCLBack.addReview()}" styleClass="btn btn-success" />

                    </p:outputLabel>
                </h:form>

                <p:outputPanel rendered="#{!trackCLBack.loggedIn}" >
                    <p>Please <h:link outcome="login">Login</h:link>/<h:link outcome="register">Register</h:link> to review this Track</p>
                </p:outputPanel>
            </div>

            <div>
                <ui:repeat value="#{trackCLBack.reviews}" var="review">

                    <p:outputPanel style="margin-bottom: 3px; margin-top: 3px;">
                        <p:panel style="min-width: 400px" footer="Date: #{review.reviewDate.toLocalDate()}">
                            <f:facet name="header">
                                <p:outputLabel><span style=" font-weight: normal">User:</span> <span style="font-weight: bold;">#{review.user.username}</span> <p:rating readonly="true" value="#{review.rating}" /> </p:outputLabel> 
                            </f:facet>
                            <p:outputLabel>#{review.text}</p:outputLabel>


                        </p:panel>
                    </p:outputPanel>


                </ui:repeat>


            </div>
        </div>
        
        
    </ui:define>


</ui:composition>
