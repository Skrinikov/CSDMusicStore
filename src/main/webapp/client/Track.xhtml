<ui:composition
    template="/WEB-INF/templates/master.xhtml"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:c="http://xmlns.jcp.org/jsp/jstl/core">

    <ui:define name="extra-meta">

        <f:metadata>
            <f:viewParam name="id" value="#{trackCLBack.trackId}" /> 
            <f:event type="preRenderView" listener="#{trackCLBack.init}" />
        </f:metadata>

    </ui:define>

    <ui:define name="windowTitle">#{trackCLBack.title}</ui:define>

    <ui:define name="content">
        <div class="container top-buffer" >

            <div class="row album-header album-row"> 
                <div class="col-md-3 col-xs-12">
                    <p:graphicImage name="images/covers/#{trackCLBack.track.coverFile}"  style="max-width: 100%;" styleClass="albumHeader"/>
                </div>
                <div class="col-md-9 col-xs-12" style="position:relative;">
                    <h3>Track</h3>
                    <h1>#{trackCLBack.track.title}</h1>
                    <h3>Artist(s): #{trackCLBack.artists}</h3>
                    <h3>Genre: #{trackCLBack.track.genre}</h3>
                    <h3>Duration: #{trackCLBack.duration}</h3>
                    <h3>Writer(s): #{trackCLBack.writer}</h3>
                    <div class="album-actions">
                        <h:form>
                            <h:commandButton value="#{trackCLBack.getPrice(trackCLBack.track)}" action="#{trackCLBack.addToCart()}" class="btn btn-success"/>
                        </h:form>
                    </div>
                </div>
            </div>
            <div class="row album-additional-information">
                <p>Album: 
                    <h:link outcome="Album">
                        <span>#{trackCLBack.album}</span>
                        <f:param name="id" value="#{trackCLBack.album.id}" />
                    </h:link> 
                </p>
            </div>

            <div class="row top-buffer">
                <h3 class="similar-albums-header">Reviews</h3>
            </div>

            <div class="row top-buffer">
                <h3 class="similar-albums-header">Related Tracks</h3>
            </div>

            <div class="row text-center" style="margin-bottom: 20px;">
                <ui:repeat var="relatedTrack" value="#{trackCLBack.similarTracks}" >
                    <div class="col-md-4 col-xs-12 similar-albums small-margin-bottom">
                        <div class="similar-albums-inner">
                            <h:link outcome="Track">
                                <p:graphicImage name="images/covers/#{relatedTrack.coverFile}"  style="max-height: 275px"/>
                                <h3>#{relatedTrack.title}</h3>
                                <h5>#{relatedTrack.album.artist.name}</h5>
                                <h6>#{relatedTrack.album.title}</h6>
                            </h:link>
                        </div>
                    </div>
                </ui:repeat>
            </div>
        </div>




        <div class="col-md-4">
            <div>
                <h4>Reviews</h4>
                <div>
                    <div>

                        <!-- Review Form Section -->
                        <h:form rendered="#{login.loggedIn}">
                            <p:outputLabel>
                                <h5>Add a Review</h5>
                                <p:inputTextarea rows="10" cols="50" value="#{trackCLBack.review.text}" />

                                <br />

                                <p:inputText value="#{trackCLBack.review.rating}"/>

                                <h:commandButton value="Submit" action="#{trackCLBack.addReview()}" styleClass="ui-priority-primary">
                                    <!--<f:param name="id" value="#{trackCLBack.trackId}"/>-->
                                </h:commandButton>
                            </p:outputLabel>
                        </h:form>
                    </div>




                    <div>

                        <ui:repeat value="#{trackCLBack.reviews}" var="review">

                            <p:outputPanel>
                                <p:panel style="min-width: 400px" header="#{review.user.username}" footer="#{review.reviewDate}">
                                    <p:outputLabel>#{review.text}</p:outputLabel>
                                </p:panel>
                            </p:outputPanel>


                        </ui:repeat>
                    </div>
                </div>
            </div>
        </div>

        
    </ui:define>

    <ui:define name="footer"></ui:define>

</ui:composition>
